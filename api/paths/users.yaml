# User endpoints
/users:
  get:
    tags:
      - Users
    summary: List users
    description: |
      Returns a paginated list of users in the system. Users are people who
      can log in to the application. Supports search by name or email and
      cursor-based pagination for large datasets.
    operationId: listUsers
    parameters:
      - name: limit
        in: query
        type: integer
        default: 20
        minimum: 1
        maximum: 100
      - name: cursor
        in: query
        type: string
      - name: search
        in: query
        type: string
        description: Search by name or email
    responses:
      200:
        description: List of users
        schema:
          $ref: '../schemas/users.yaml#/UserList'
      401:
        $ref: '../responses/errors.yaml#/Unauthorized'
  post:
    tags:
      - Users
    summary: Create user
    description: |
      Creates a new user account and optionally assigns a user group and data scope.
      Requires users.manage permission.
    operationId: createUser
    parameters:
      - name: body
        in: body
        required: true
        schema:
          $ref: '../schemas/users.yaml#/CreateUserRequest'
    responses:
      201:
        description: Created user
        schema:
          $ref: '../schemas/users.yaml#/User'
      400:
        $ref: '../responses/errors.yaml#/BadRequest'
      401:
        $ref: '../responses/errors.yaml#/Unauthorized'
      403:
        $ref: '../responses/errors.yaml#/Forbidden'

/users/{id}:
  get:
    tags:
      - Users
    summary: Get user by ID
    description: |
      Retrieves a single user's profile including email, display name, avatar,
      and role. Use this to display user details or populate an edit form.
    operationId: getUser
    parameters:
      - name: id
        in: path
        required: true
        type: string
        format: uuid
    responses:
      200:
        description: User details
        schema:
          $ref: '../schemas/users.yaml#/User'
      401:
        $ref: '../responses/errors.yaml#/Unauthorized'
      404:
        $ref: '../responses/errors.yaml#/NotFound'
  patch:
    tags:
      - Users
    summary: Update user
    description: |
      Updates a user's profile information. Users can update their own profile;
      admins can update any user. Supports partial updates - only include
      fields that should change.
    operationId: updateUser
    parameters:
      - name: id
        in: path
        required: true
        type: string
        format: uuid
      - name: body
        in: body
        required: true
        schema:
          $ref: '../schemas/users.yaml#/UpdateUserRequest'
    responses:
      200:
        description: Updated user
        schema:
          $ref: '../schemas/users.yaml#/User'
      400:
        $ref: '../responses/errors.yaml#/BadRequest'
      401:
        $ref: '../responses/errors.yaml#/Unauthorized'
      403:
        $ref: '../responses/errors.yaml#/Forbidden'
      404:
        $ref: '../responses/errors.yaml#/NotFound'
  delete:
    tags:
      - Users
    summary: Delete user
    description: |
      Deletes a user account. Admin only.
    operationId: deleteUser
    parameters:
      - name: id
        in: path
        required: true
        type: string
        format: uuid
    responses:
      204:
        description: User deleted
      401:
        $ref: '../responses/errors.yaml#/Unauthorized'
      403:
        $ref: '../responses/errors.yaml#/Forbidden'
      404:
        $ref: '../responses/errors.yaml#/NotFound'

/users/{id}/password:
  post:
    tags:
      - Users
    summary: Change user password
    description: |
      Updates the password for a user. Users can change their own password; admins can reset any user's password.
    operationId: changeUserPassword
    parameters:
      - name: id
        in: path
        required: true
        type: string
        format: uuid
      - name: body
        in: body
        required: true
        schema:
          $ref: '../schemas/users.yaml#/ChangePasswordRequest'
    responses:
      204:
        description: Password updated
      400:
        $ref: '../responses/errors.yaml#/BadRequest'
      401:
        $ref: '../responses/errors.yaml#/Unauthorized'
      403:
        $ref: '../responses/errors.yaml#/Forbidden'
      404:
        $ref: '../responses/errors.yaml#/NotFound'
