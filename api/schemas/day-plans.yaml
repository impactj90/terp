# Day Plan-related schemas
DayPlan:
  type: object
  required:
    - id
    - tenant_id
    - code
    - name
    - plan_type
    - regular_hours
  properties:
    id:
      type: string
      format: uuid
    tenant_id:
      type: string
      format: uuid
    code:
      type: string
      example: "PLAN-001"
    name:
      type: string
      example: "Standard Day"
    description:
      type: string
      x-nullable: true
    plan_type:
      type: string
      enum:
        - fixed
        - flextime
      example: "fixed"
    # Time windows (minutes from midnight)
    come_from:
      type: integer
      description: Earliest allowed arrival (minutes from midnight)
      x-nullable: true
      example: 420
    come_to:
      type: integer
      description: Latest allowed arrival (minutes from midnight)
      x-nullable: true
      example: 540
    go_from:
      type: integer
      description: Earliest allowed departure (minutes from midnight)
      x-nullable: true
      example: 960
    go_to:
      type: integer
      description: Latest allowed departure (minutes from midnight)
      x-nullable: true
      example: 1080
    core_start:
      type: integer
      description: Core time start (minutes from midnight)
      x-nullable: true
      example: 540
    core_end:
      type: integer
      description: Core time end (minutes from midnight)
      x-nullable: true
      example: 960
    # Target hours
    regular_hours:
      type: integer
      description: Target working hours in minutes
      example: 480
    regular_hours_2:
      type: integer
      description: Alternative target hours for absence days (minutes)
      x-nullable: true
    from_employee_master:
      type: boolean
      description: Get target hours from employee master data
    # Tolerance settings
    tolerance_come_plus:
      type: integer
      description: Tolerance for late arrival (minutes)
      example: 0
    tolerance_come_minus:
      type: integer
      description: Tolerance for early arrival (minutes)
      example: 0
    tolerance_go_plus:
      type: integer
      description: Tolerance for late departure (minutes)
      example: 0
    tolerance_go_minus:
      type: integer
      description: Tolerance for early departure (minutes)
      example: 0
    variable_work_time:
      type: boolean
      description: Enable tolerance_come_minus for fixed working time plans
    # Rounding settings
    rounding_come_type:
      type: string
      enum:
        - none
        - up
        - down
        - nearest
        - add
        - subtract
      x-nullable: true
    rounding_come_interval:
      type: integer
      description: Rounding interval in minutes
      x-nullable: true
    rounding_come_add_value:
      type: integer
      description: Value to add/subtract for arrival (minutes)
      x-nullable: true
    rounding_go_type:
      type: string
      enum:
        - none
        - up
        - down
        - nearest
        - add
        - subtract
      x-nullable: true
    rounding_go_interval:
      type: integer
      description: Rounding interval in minutes
      x-nullable: true
    rounding_go_add_value:
      type: integer
      description: Value to add/subtract for departure (minutes)
      x-nullable: true
    round_all_bookings:
      type: boolean
      description: Round all bookings vs first arrival/last departure only
    # Caps
    min_work_time:
      type: integer
      description: Minimum work time in minutes
      x-nullable: true
    max_net_work_time:
      type: integer
      description: Maximum net work time in minutes
      x-nullable: true
    # Holiday credits (minutes)
    holiday_credit_cat1:
      type: integer
      description: Full holiday time credit (minutes)
      x-nullable: true
    holiday_credit_cat2:
      type: integer
      description: Half holiday time credit (minutes)
      x-nullable: true
    holiday_credit_cat3:
      type: integer
      description: Custom category holiday credit (minutes)
      x-nullable: true
    # Vacation deduction
    vacation_deduction:
      type: number
      format: float
      description: Vacation days deducted per day (default 1.0)
    # Special behaviors
    no_booking_behavior:
      type: string
      enum:
        - error
        - deduct_target
        - vocational_school
        - adopt_target
        - target_with_order
      description: Behavior when no bookings recorded
    day_change_behavior:
      type: string
      enum:
        - none
        - at_arrival
        - at_departure
        - auto_complete
      description: How to handle cross-midnight shifts
    # Shift detection windows (minutes from midnight)
    shift_detect_arrive_from:
      type: integer
      description: Shift detection arrival window start (minutes)
      x-nullable: true
    shift_detect_arrive_to:
      type: integer
      description: Shift detection arrival window end (minutes)
      x-nullable: true
    shift_detect_depart_from:
      type: integer
      description: Shift detection departure window start (minutes)
      x-nullable: true
    shift_detect_depart_to:
      type: integer
      description: Shift detection departure window end (minutes)
      x-nullable: true
    # Alternative day plans for shift detection
    shift_alt_plan_1:
      type: string
      format: uuid
      x-nullable: true
    shift_alt_plan_2:
      type: string
      format: uuid
      x-nullable: true
    shift_alt_plan_3:
      type: string
      format: uuid
      x-nullable: true
    shift_alt_plan_4:
      type: string
      format: uuid
      x-nullable: true
    shift_alt_plan_5:
      type: string
      format: uuid
      x-nullable: true
    shift_alt_plan_6:
      type: string
      format: uuid
      x-nullable: true
    is_active:
      type: boolean
      example: true
    created_at:
      type: string
      format: date-time
    updated_at:
      type: string
      format: date-time
    # Relations
    breaks:
      type: array
      items:
        $ref: '#/DayPlanBreak'
    bonuses:
      type: array
      items:
        $ref: '#/DayPlanBonus'

DayPlanSummary:
  type: object
  required:
    - id
    - code
    - name
    - plan_type
  properties:
    id:
      type: string
      format: uuid
    code:
      type: string
    name:
      type: string
    plan_type:
      type: string

DayPlanBreak:
  type: object
  required:
    - id
    - day_plan_id
    - break_type
    - duration
  properties:
    id:
      type: string
      format: uuid
    day_plan_id:
      type: string
      format: uuid
    break_type:
      type: string
      enum:
        - fixed
        - variable
        - minimum
      example: "fixed"
    start_time:
      type: integer
      description: Break start (minutes from midnight)
      x-nullable: true
    end_time:
      type: integer
      description: Break end (minutes from midnight)
      x-nullable: true
    duration:
      type: integer
      description: Break duration in minutes
      example: 30
    after_work_minutes:
      type: integer
      description: Auto-deduct break after this much work time
      x-nullable: true
    auto_deduct:
      type: boolean
      description: Automatically deduct break
      example: true
    is_paid:
      type: boolean
      description: Is this break paid
      example: false
    minutes_difference:
      type: boolean
      description: Proportional deduction when near threshold (for minimum breaks)
    sort_order:
      type: integer
      example: 0
    created_at:
      type: string
      format: date-time
    updated_at:
      type: string
      format: date-time

DayPlanBonus:
  type: object
  required:
    - id
    - day_plan_id
    - account_id
    - time_from
    - time_to
    - calculation_type
    - value_minutes
  properties:
    id:
      type: string
      format: uuid
    day_plan_id:
      type: string
      format: uuid
    account_id:
      type: string
      format: uuid
    time_from:
      type: integer
      description: Bonus time range start (minutes from midnight)
      example: 1200
    time_to:
      type: integer
      description: Bonus time range end (minutes from midnight)
      example: 1380
    calculation_type:
      type: string
      enum:
        - fixed
        - per_minute
        - percentage
      example: "per_minute"
    value_minutes:
      type: integer
      description: Bonus value in minutes
      example: 15
    min_work_minutes:
      type: integer
      description: Minimum work required for bonus
      x-nullable: true
    applies_on_holiday:
      type: boolean
      example: false
    sort_order:
      type: integer
      example: 0
    created_at:
      type: string
      format: date-time
    updated_at:
      type: string
      format: date-time
    # Relations
    account:
      allOf:
        - $ref: './accounts.yaml#/Account'
      x-nullable: true

CreateDayPlanRequest:
  type: object
  required:
    - code
    - name
    - plan_type
    - regular_hours
  properties:
    code:
      type: string
      minLength: 1
      maxLength: 20
    name:
      type: string
      minLength: 1
      maxLength: 255
    description:
      type: string
    plan_type:
      type: string
      enum:
        - fixed
        - flextime
    come_from:
      type: integer
    come_to:
      type: integer
    go_from:
      type: integer
    go_to:
      type: integer
    core_start:
      type: integer
    core_end:
      type: integer
    regular_hours:
      type: integer
    regular_hours_2:
      type: integer
    from_employee_master:
      type: boolean
    tolerance_come_plus:
      type: integer
    tolerance_come_minus:
      type: integer
    tolerance_go_plus:
      type: integer
    tolerance_go_minus:
      type: integer
    variable_work_time:
      type: boolean
    rounding_come_type:
      type: string
      enum:
        - none
        - up
        - down
        - nearest
        - add
        - subtract
    rounding_come_interval:
      type: integer
    rounding_come_add_value:
      type: integer
    rounding_go_type:
      type: string
      enum:
        - none
        - up
        - down
        - nearest
        - add
        - subtract
    rounding_go_interval:
      type: integer
    rounding_go_add_value:
      type: integer
    round_all_bookings:
      type: boolean
    min_work_time:
      type: integer
    max_net_work_time:
      type: integer
    holiday_credit_cat1:
      type: integer
    holiday_credit_cat2:
      type: integer
    holiday_credit_cat3:
      type: integer
    vacation_deduction:
      type: number
      format: float
    no_booking_behavior:
      type: string
      enum:
        - error
        - deduct_target
        - vocational_school
        - adopt_target
        - target_with_order
    day_change_behavior:
      type: string
      enum:
        - none
        - at_arrival
        - at_departure
        - auto_complete
    shift_detect_arrive_from:
      type: integer
    shift_detect_arrive_to:
      type: integer
    shift_detect_depart_from:
      type: integer
    shift_detect_depart_to:
      type: integer
    shift_alt_plan_1:
      type: string
      format: uuid
    shift_alt_plan_2:
      type: string
      format: uuid
    shift_alt_plan_3:
      type: string
      format: uuid
    shift_alt_plan_4:
      type: string
      format: uuid
    shift_alt_plan_5:
      type: string
      format: uuid
    shift_alt_plan_6:
      type: string
      format: uuid
    is_active:
      type: boolean

UpdateDayPlanRequest:
  type: object
  properties:
    name:
      type: string
      minLength: 1
      maxLength: 255
    description:
      type: string
    plan_type:
      type: string
      enum:
        - fixed
        - flextime
    come_from:
      type: integer
    come_to:
      type: integer
    go_from:
      type: integer
    go_to:
      type: integer
    core_start:
      type: integer
    core_end:
      type: integer
    regular_hours:
      type: integer
    regular_hours_2:
      type: integer
    from_employee_master:
      type: boolean
    tolerance_come_plus:
      type: integer
    tolerance_come_minus:
      type: integer
    tolerance_go_plus:
      type: integer
    tolerance_go_minus:
      type: integer
    variable_work_time:
      type: boolean
    rounding_come_type:
      type: string
      enum:
        - none
        - up
        - down
        - nearest
        - add
        - subtract
    rounding_come_interval:
      type: integer
    rounding_come_add_value:
      type: integer
    rounding_go_type:
      type: string
      enum:
        - none
        - up
        - down
        - nearest
        - add
        - subtract
    rounding_go_interval:
      type: integer
    rounding_go_add_value:
      type: integer
    round_all_bookings:
      type: boolean
    min_work_time:
      type: integer
    max_net_work_time:
      type: integer
    holiday_credit_cat1:
      type: integer
    holiday_credit_cat2:
      type: integer
    holiday_credit_cat3:
      type: integer
    vacation_deduction:
      type: number
      format: float
    no_booking_behavior:
      type: string
      enum:
        - error
        - deduct_target
        - vocational_school
        - adopt_target
        - target_with_order
    day_change_behavior:
      type: string
      enum:
        - none
        - at_arrival
        - at_departure
        - auto_complete
    shift_detect_arrive_from:
      type: integer
    shift_detect_arrive_to:
      type: integer
    shift_detect_depart_from:
      type: integer
    shift_detect_depart_to:
      type: integer
    shift_alt_plan_1:
      type: string
      format: uuid
    shift_alt_plan_2:
      type: string
      format: uuid
    shift_alt_plan_3:
      type: string
      format: uuid
    shift_alt_plan_4:
      type: string
      format: uuid
    shift_alt_plan_5:
      type: string
      format: uuid
    shift_alt_plan_6:
      type: string
      format: uuid
    is_active:
      type: boolean

CopyDayPlanRequest:
  type: object
  required:
    - new_code
    - new_name
  properties:
    new_code:
      type: string
      minLength: 1
      maxLength: 20
    new_name:
      type: string
      minLength: 1
      maxLength: 255

CreateDayPlanBreakRequest:
  type: object
  required:
    - break_type
    - duration
  properties:
    break_type:
      type: string
      enum:
        - fixed
        - variable
        - minimum
    start_time:
      type: integer
    end_time:
      type: integer
    duration:
      type: integer
    after_work_minutes:
      type: integer
    auto_deduct:
      type: boolean
      default: true
    is_paid:
      type: boolean
      default: false
    minutes_difference:
      type: boolean
      default: false

CreateDayPlanBonusRequest:
  type: object
  required:
    - account_id
    - time_from
    - time_to
    - calculation_type
    - value_minutes
  properties:
    account_id:
      type: string
      format: uuid
    time_from:
      type: integer
    time_to:
      type: integer
    calculation_type:
      type: string
      enum:
        - fixed
        - per_minute
        - percentage
    value_minutes:
      type: integer
    min_work_minutes:
      type: integer
    applies_on_holiday:
      type: boolean
      default: false

DayPlanList:
  type: object
  required:
    - data
  properties:
    data:
      type: array
      items:
        $ref: '#/DayPlan'
