# Tariff-related schemas
Tariff:
  type: object
  required:
    - id
    - tenant_id
    - code
    - name
  properties:
    id:
      type: string
      format: uuid
    tenant_id:
      type: string
      format: uuid
    code:
      type: string
      example: "TARIFF-001"
    name:
      type: string
      example: "Standard Tariff"
    description:
      type: string
      x-nullable: true
    week_plan_id:
      type: string
      format: uuid
      x-nullable: true
    valid_from:
      type: string
      format: date
      x-nullable: true
    valid_to:
      type: string
      format: date
      x-nullable: true
    is_active:
      type: boolean
      example: true

    # ZMI Vacation Fields
    annual_vacation_days:
      type: number
      format: double
      description: "ZMI: Jahresurlaub - Base annual vacation days"
      example: 30.0
      x-nullable: true
    work_days_per_week:
      type: integer
      minimum: 1
      maximum: 7
      description: "ZMI: AT pro Woche - Work days per week for vacation pro-rating"
      example: 5
      x-nullable: true
    vacation_basis:
      type: string
      enum:
        - calendar_year
        - entry_date
      description: "ZMI: Urlaubsberechnung Basis - Vacation year calculation basis"
      example: "calendar_year"

    # ZMI Target Hours Fields
    daily_target_hours:
      type: number
      format: double
      description: "ZMI: Tagessollstunden - Daily target hours"
      example: 8.0
      x-nullable: true
    weekly_target_hours:
      type: number
      format: double
      description: "ZMI: Wochensollstunden - Weekly target hours"
      example: 40.0
      x-nullable: true
    monthly_target_hours:
      type: number
      format: double
      description: "ZMI: Monatssollstunden - Monthly target hours"
      example: 173.33
      x-nullable: true
    annual_target_hours:
      type: number
      format: double
      description: "ZMI: Jahressollstunden - Annual target hours"
      example: 2080.0
      x-nullable: true

    # ZMI Flextime Fields
    max_flextime_per_month:
      type: integer
      description: "ZMI: Max Gleitzeit im Monat - Max monthly flextime credit in minutes"
      example: 600
      x-nullable: true
    upper_limit_annual:
      type: integer
      description: "ZMI: Obergrenze Jahreszeitkonto - Annual flextime cap in minutes"
      example: 2400
      x-nullable: true
    lower_limit_annual:
      type: integer
      description: "ZMI: Untergrenze Jahreszeitkonto - Annual flextime floor in minutes (can be negative)"
      example: -600
      x-nullable: true
    flextime_threshold:
      type: integer
      description: "ZMI: Gleitzeitschwelle - Overtime threshold in minutes"
      example: 60
      x-nullable: true
    credit_type:
      type: string
      enum:
        - no_evaluation
        - complete
        - after_threshold
        - no_carryover
      description: "ZMI: Art der Gutschrift - How flextime is credited at month end"
      example: "no_evaluation"

    # ZMI Rhythm Fields
    rhythm_type:
      type: string
      enum:
        - weekly
        - rolling_weekly
        - x_days
      description: "ZMI: Zeitplan-Modell - Time plan rhythm type"
      example: "weekly"
    cycle_days:
      type: integer
      minimum: 1
      maximum: 365
      description: "ZMI: Tage im Zyklus - For x_days rhythm, number of days in cycle"
      example: 14
      x-nullable: true
    rhythm_start_date:
      type: string
      format: date
      description: "ZMI: Rhythmus-Startdatum - Start date for rhythm calculation"
      x-nullable: true

    created_at:
      type: string
      format: date-time
    updated_at:
      type: string
      format: date-time
    # Expanded relations
    week_plan:
      allOf:
        - $ref: './week-plans.yaml#/WeekPlanSummary'
      x-nullable: true
    breaks:
      type: array
      items:
        $ref: '#/TariffBreak'
    tariff_week_plans:
      type: array
      description: "Ordered week plans for rolling_weekly rhythm"
      items:
        $ref: '#/TariffWeekPlan'
    tariff_day_plans:
      type: array
      description: "Day plans for x_days rhythm"
      items:
        $ref: '#/TariffDayPlan'

TariffSummary:
  type: object
  required:
    - id
    - code
    - name
  properties:
    id:
      type: string
      format: uuid
    code:
      type: string
    name:
      type: string

TariffBreak:
  type: object
  required:
    - id
    - tariff_id
    - break_type
    - duration
  properties:
    id:
      type: string
      format: uuid
    tariff_id:
      type: string
      format: uuid
    break_type:
      type: string
      enum:
        - fixed
        - variable
        - minimum
      example: "minimum"
    after_work_minutes:
      type: integer
      description: Deduct break after this much work time
      example: 360
    duration:
      type: integer
      description: Break duration in minutes
      example: 30
    is_paid:
      type: boolean
      example: false
    sort_order:
      type: integer
      example: 0
    created_at:
      type: string
      format: date-time
    updated_at:
      type: string
      format: date-time

TariffWeekPlan:
  type: object
  required:
    - id
    - tariff_id
    - week_plan_id
    - sequence_order
  properties:
    id:
      type: string
      format: uuid
    tariff_id:
      type: string
      format: uuid
    week_plan_id:
      type: string
      format: uuid
    sequence_order:
      type: integer
      description: "Position in rotation (1-based)"
      example: 1
    created_at:
      type: string
      format: date-time
    week_plan:
      allOf:
        - $ref: './week-plans.yaml#/WeekPlanSummary'
      x-nullable: true

TariffDayPlan:
  type: object
  required:
    - id
    - tariff_id
    - day_position
  properties:
    id:
      type: string
      format: uuid
    tariff_id:
      type: string
      format: uuid
    day_position:
      type: integer
      description: "Position in cycle (1-based)"
      example: 1
    day_plan_id:
      type: string
      format: uuid
      x-nullable: true
      description: "NULL = off day"
    created_at:
      type: string
      format: date-time
    day_plan:
      allOf:
        - $ref: './day-plans.yaml#/DayPlanSummary'
      x-nullable: true

TariffDayPlanInput:
  type: object
  required:
    - day_position
  properties:
    day_position:
      type: integer
      minimum: 1
      description: "Position in cycle (1-based)"
    day_plan_id:
      type: string
      format: uuid
      x-nullable: true
      description: "Day plan ID, null for off day"

CreateTariffRequest:
  type: object
  required:
    - code
    - name
  properties:
    code:
      type: string
      minLength: 1
      maxLength: 20
    name:
      type: string
      minLength: 1
      maxLength: 255
    description:
      type: string
    week_plan_id:
      type: string
      format: uuid
    valid_from:
      type: string
      format: date
    valid_to:
      type: string
      format: date

    # ZMI Rhythm Fields
    rhythm_type:
      type: string
      enum:
        - weekly
        - rolling_weekly
        - x_days
      description: "Time plan rhythm type (default: weekly)"
    cycle_days:
      type: integer
      minimum: 1
      maximum: 365
      description: "For x_days rhythm: number of days in cycle"
    rhythm_start_date:
      type: string
      format: date
      description: "Start date for rhythm calculation"
    week_plan_ids:
      type: array
      description: "For rolling_weekly: ordered list of week plan IDs"
      items:
        type: string
        format: uuid
    day_plans:
      type: array
      description: "For x_days: day plans per position in cycle"
      items:
        $ref: '#/TariffDayPlanInput'

    # ZMI Vacation Fields
    annual_vacation_days:
      type: number
      format: double
    work_days_per_week:
      type: integer
      minimum: 1
      maximum: 7
    vacation_basis:
      type: string
      enum:
        - calendar_year
        - entry_date

    # ZMI Target Hours Fields
    daily_target_hours:
      type: number
      format: double
    weekly_target_hours:
      type: number
      format: double
    monthly_target_hours:
      type: number
      format: double
    annual_target_hours:
      type: number
      format: double

    # ZMI Flextime Fields
    max_flextime_per_month:
      type: integer
    upper_limit_annual:
      type: integer
    lower_limit_annual:
      type: integer
    flextime_threshold:
      type: integer
    credit_type:
      type: string
      enum:
        - no_evaluation
        - complete
        - after_threshold
        - no_carryover

UpdateTariffRequest:
  type: object
  properties:
    name:
      type: string
      minLength: 1
      maxLength: 255
    description:
      type: string
    week_plan_id:
      type: string
      format: uuid
    valid_from:
      type: string
      format: date
    valid_to:
      type: string
      format: date
    is_active:
      type: boolean

    # ZMI Rhythm Fields
    rhythm_type:
      type: string
      enum:
        - weekly
        - rolling_weekly
        - x_days
      description: "Time plan rhythm type"
    cycle_days:
      type: integer
      minimum: 1
      maximum: 365
      x-nullable: true
      description: "For x_days rhythm: number of days in cycle"
    rhythm_start_date:
      type: string
      format: date
      x-nullable: true
      description: "Start date for rhythm calculation"
    week_plan_ids:
      type: array
      description: "For rolling_weekly: ordered list of week plan IDs"
      items:
        type: string
        format: uuid
    day_plans:
      type: array
      description: "For x_days: day plans per position in cycle"
      items:
        $ref: '#/TariffDayPlanInput'

    # ZMI Vacation Fields
    annual_vacation_days:
      type: number
      format: double
      x-nullable: true
    work_days_per_week:
      type: integer
      minimum: 1
      maximum: 7
      x-nullable: true
    vacation_basis:
      type: string
      enum:
        - calendar_year
        - entry_date

    # ZMI Target Hours Fields
    daily_target_hours:
      type: number
      format: double
      x-nullable: true
    weekly_target_hours:
      type: number
      format: double
      x-nullable: true
    monthly_target_hours:
      type: number
      format: double
      x-nullable: true
    annual_target_hours:
      type: number
      format: double
      x-nullable: true

    # ZMI Flextime Fields
    max_flextime_per_month:
      type: integer
      x-nullable: true
    upper_limit_annual:
      type: integer
      x-nullable: true
    lower_limit_annual:
      type: integer
      x-nullable: true
    flextime_threshold:
      type: integer
      x-nullable: true
    credit_type:
      type: string
      enum:
        - no_evaluation
        - complete
        - after_threshold
        - no_carryover

CreateTariffBreakRequest:
  type: object
  required:
    - break_type
    - duration
  properties:
    break_type:
      type: string
      enum:
        - fixed
        - variable
        - minimum
    after_work_minutes:
      type: integer
    duration:
      type: integer
    is_paid:
      type: boolean
      default: false

TariffList:
  type: object
  required:
    - data
  properties:
    data:
      type: array
      items:
        $ref: '#/Tariff'
